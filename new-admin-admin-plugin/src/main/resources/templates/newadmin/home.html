<!--
 ~ Copyright 2022 youngmonkeys.org
 ~ 
 ~ Licensed under the ezyplatform, Version 1.0.0 (the "License");
 ~ you may not use this file except in compliance with the License.
 ~ You may obtain a copy of the License at
 ~ 
 ~     https://youngmonkeys.org/licenses/ezyplatform-1.0.0.txt
 ~ 
 ~ Unless required by applicable law or agreed to in writing, software
 ~ distributed under the License is distributed on an "AS IS" BASIS,
 ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 ~ See the License for the specific language governing permissions and
 ~ limitations under the License.
-->

<!DOCTYPE html>
<html
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:th="http://www.thymeleaf.org"
  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
  layout:decorate="~{newadmin}"
>
  <body>
    <div layout:fragment="content" class="row">
      <div th:if="${adminRoles.isAccessible('/users')}" class="col-lg-3 col-6">
        <!-- small box -->
        <div class="card bg-info">
          <div class="card-body">
            <div class="row d-flex justify-content-center">
              <div class="col">
                <p class="text-dark mb-0 fw-semibold">[[#{users}]]</p>
                <h3
                  class="my-1 fs-20 commas-number-string"
                  th:text="${totalUser}"
                >
                  150
                </h3>
                <a
                  href="/users"
                  class="mb-0 text-truncate text-bg-primary badge"
                  >[[#{more_info}]] <i class="fas fa-arrow-circle-right"></i
                ></a>
              </div>
              <div class="col-auto align-self-center">
                <div
                  class="flex-shrink-0 bg-info-subtle text-info thumb-md rounded-circle"
                >
                  <i class="iconoir-rocket fs-4"></i>
                </div>
              </div>
            </div>
          </div>
          <!--end card-body-->
        </div>
      </div>
      <!-- ./col -->
      <div
        th:if="${adminRoles.isAccessible('/dashboard/web')}"
        class="col-lg-3 col-6"
      >
        <!-- small box -->
        <div class="card bg-success" id="boxWeb">
          <div class="card-body">
            <div class="row d-flex justify-content-center">
              <div class="col">
                <p class="text-dark mb-0 fw-semibold">[[#{web}]]</p>
                <h3 id="boxWebTitle" class="my-1 fs-20">[[#{running}]]</h3>
                <a
                  href="/dashboard/web"
                  class="mb-0 text-truncate text-bg-primary badge"
                  >[[#{more_info}]] <i class="fas fa-arrow-circle-right"></i
                ></a>
              </div>
              <div class="col-auto align-self-center">
                <div
                  class="flex-shrink-0 bg-success-subtle text-success thumb-md rounded-circle"
                >
                  <i class="iconoir-group fs-4"></i>
                </div>
              </div>
            </div>
          </div>
          <!--end card-body-->
        </div>
      </div>
      <!-- ./col -->
      <div
        th:if="${adminRoles.isAccessible('/dashboard/socket')}"
        class="col-lg-3 col-6"
      >
        <!-- small box -->
        <div class="card bg-danger">
          <div class="card-body">
            <div class="row d-flex justify-content-center">
              <div class="col">
                <p class="text-dark mb-0 fw-semibold">[[#{socket}]]</p>
                <h3 id="boxSocketTitle" class="my-1 fs-20">[[#{running}]]</h3>
                <a
                  href="/dashboard/socket"
                  class="mb-0 text-truncate text-bg-primary badge"
                  >[[#{more_info}]] <i class="fas fa-arrow-circle-right"></i
                ></a>
              </div>
              <div class="col-auto align-self-center">
                <div
                  class="flex-shrink-0 bg-primary-subtle text-primary thumb-md rounded-circle"
                >
                  <i class="iconoir-rocket fs-4"></i>
                </div>
              </div>
            </div>
          </div>
          <!--end card-body-->
        </div>
      </div>
      <!-- ./col -->
      <div
        th:if="${adminRoles.isAccessible('/dashboard/admin')}"
        class="col-lg-3 col-6"
      >
        <!-- small box -->
        <div class="card bg-primary" id="boxAdmin">
          <div class="card-body">
            <div class="row d-flex justify-content-center">
              <div class="col">
                <p class="text-dark mb-0 fw-semibold">[[#{admin}]]</p>
                <h3 id="boxAdminTitle" class="my-1 fs-20">[[#{running}]]</h3>
                <a
                  href="/dashboard/admin"
                  class="mb-0 text-truncate text-bg-primary badge"
                  >[[#{more_info}]] <i class="fas fa-arrow-circle-right"></i
                ></a>
              </div>
              <div class="col-auto align-self-center">
                <div
                  class="flex-shrink-0 bg-primary-subtle text-primary thumb-md rounded-circle"
                >
                  <i class="iconoir-suitcase fs-4"></i>
                </div>
              </div>
            </div>
          </div>
          <!--end card-body-->
        </div>
      </div>
      <!-- ./col -->
      <div th:if="${adminRoles.isAccessible('/admins')}" class="col-lg-3 col-6">
        <!-- small box -->
        <div class="card bg-warning">
          <div class="card-body">
            <div class="row d-flex justify-content-center">
              <div class="col">
                <p class="text-dark mb-0 fw-semibold">[[#{administrators}]]</p>
                <h3
                  class="my-1 fs-20 commas-number-string"
                  th:text="${totalAdmin}"
                >
                  150
                </h3>
                <a
                  href="/admins"
                  class="mb-0 text-truncate text-bg-primary badge"
                  >[[#{more_info}]] <i class="fas fa-arrow-circle-right"></i
                ></a>
              </div>
              <div class="col-auto align-self-center">
                <div
                  class="flex-shrink-0 bg-warning-subtle text-warning thumb-md rounded-circle"
                >
                  <i class="iconoir-user fs-4"></i>
                </div>
              </div>
            </div>
          </div>
          <!--end card-body-->
        </div>
      </div>
    </div>
    <script layout:fragment="scripts">
      ezyadmin.targets = {
        admin: {
          managementUrl: "",
        },
        web: {
          managementUrl: ezyadmin.webManagementUrl,
        },
      };

      ezyadmin.connectionSuccessFunc = function (boxId, colorClass) {
        $("#" + boxId + "Title").text(ezyadmin.messages.running);
        $("#" + boxId)
          .addClass(colorClass)
          .removeClass("bg-secondary");
      };

      ezyadmin.connectionFailFunc = function (boxId, colorClass) {
        $("#" + boxId + "Title").text(ezyadmin.messages.off);
        $("#" + boxId)
          .addClass("bg-secondary")
          .removeClass(colorClass);
      };

      ezyadmin.pingTarget = function (target) {
        var boxId = "boxWeb";
        var colorClass = "bg-success";

        if (target === "admin") {
          boxId = "boxAdmin";
          colorClass = "bg-primary";
        }

        var url = ezyadmin.targets[target].managementUrl;
        $.ajax({
          url: url + "/management/health-check",
          type: "GET",
          dataType: "json",
        })
          .done(function (data, status) {
            ezyadmin.connectionSuccessFunc(boxId, colorClass);
          })
          .fail(function (e) {
            ezyadmin.connectionFailFunc(boxId, colorClass);
          });
      };

      ezyadmin.pingTarget("admin");
      setInterval(() => {
        ezyadmin.pingTarget("admin");
      }, 3000);

      ezyadmin.pingTarget("web");
      setInterval(() => {
        ezyadmin.pingTarget("web");
      }, 3000);

      ezyadmin.socket.onConnectionFailed(() => {
        ezyadmin.connectionFailFunc("boxSocket", "bg-danger");
      });

      ezyadmin.socket.onAuthenticated(() => {
        ezyadmin.connectionSuccessFunc("boxSocket", "bg-danger");
      });

      if (!ezyadmin.socketEnable) {
        ezyadmin.connectionFailFunc("boxSocket", "bg-danger");
      }
    </script>
  </body>
</html>
